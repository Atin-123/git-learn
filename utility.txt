This is a utility function file version 2.